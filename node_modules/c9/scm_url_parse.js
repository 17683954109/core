define(function(require, exports, module) {
    "use strict";
    
    var Url = require("url");
    
    var providers = {
        "bitbucket.org": "bitbucket",
        "github.com": "github"
    };
    var defaultProvider = "unknown";
    
    module.exports = function(url) {
        var m = url.match(/^(git)@([\w\.\d\-\_]+)(?:\/|:)([\w\.\d\-\_\/]+)/);
        if (m) {
            return {
                protocol: "ssh:",
                scm: "git",
                provider: providers[m[2]] || defaultProvider,
                auth: m[1],
                hostname: m[2],
                pathname: m[3]
            };
        }
    
        var parsed = Url.parse(url);
        
        if (
            parsed &&
            parsed.protocol &&
            parsed.protocol.match(/^(git|http|https|ssh):$/) &&
            parsed.hostname &&
            parsed.slashes &&
            parsed.pathname
        )
            return {
                protocol: parsed.protocol,
                scm: parsed.pathname.match(/\.git$/) ? "git": "hg",
                provider: providers[parsed.hostname] || defaultProvider,
                auth: parsed.auth || "",
                hostname: parsed.hostname,
                pathname: parsed.pathname.replace(/^\/+/, ""),
                full: url
            };
        else
            return null;
    };
});